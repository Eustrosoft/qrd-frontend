<mat-form-field class="form-field-lg">
  <mat-label> {{ SharedLocalization.name }} </mat-label>
  <input [formControl]="form.controls.name" matInput />
  @if (form.controls.name.touched && form.controls.name.hasError('required')) {
    <mat-error>{{ SharedLocalization.fieldRequired }}</mat-error>
  }
  @if (form.controls.name.touched && form.controls.name.hasError('maxlength')) {
    <mat-error>{{ SharedLocalization.maxLength }} {{ MaxNameLength }}</mat-error>
  }
  @if (form.controls.name.touched && form.controls.name.hasError(CustomValidationErrors.DuplicatedFiles)) {
    <mat-error>{{ form.controls.name.errors?.[CustomValidationErrors.DuplicatedFiles] }}</mat-error>
  }
</mat-form-field>
<mat-form-field class="form-field-lg">
  <mat-label> {{ SharedLocalization.description }} </mat-label>
  <textarea [formControl]="form.controls.description" matInput></textarea>
  @if (form.controls.description.touched && form.controls.description.hasError('required')) {
    <mat-error>{{ SharedLocalization.fieldRequired }}</mat-error>
  }
  @if (form.controls.description.touched && form.controls.description.hasError('maxlength')) {
    <mat-error>{{ SharedLocalization.maxLength }} {{ MaxDescriptionLength }}</mat-error>
  }
</mat-form-field>
@if (!fileMetadata()) {
  <input #fileInput (change)="fileChanged()" type="file" hidden />
  <ui-flex-block gapSize="8" flexAlignItems="center" ellipsis>
    @if (!form.controls.file.value) {
      <button
        (click)="fileInput.click()"
        (blur)="form.controls.file.markAsTouched()"
        class="button-xl button-secondary"
        mat-flat-button
      >
        {{ FilesLocalization.selectFile }}
      </button>
    }
    @if (form.controls.file.value) {
      <p [title]="form.controls.file.value.name" ellipsis>{{ form.controls.file.value.name }}</p>
    }
    @if (form.controls.file.touched && form.controls.file.hasError('required')) {
      <mat-icon class="icon-error" [matTooltip]="FilesLocalization.fileRequired"> error </mat-icon>
    }
    @if (form.controls.file.value) {
      <button (click)="cancelFile()" class="icon-button-sm" mat-icon-button>
        <mat-icon class="icon-secondary">close</mat-icon>
      </button>
    }
    @if (selectors.uploadState()?.isLoading) {
      <mat-progress-spinner diameter="20" [value]="selectors.uploadState()?.progress" />
    }
    @if (selectors.uploadState()?.isDone) {
      <mat-icon class="icon-secondary" style="flex: 1 0 auto" [matTooltip]="FilesLocalization.uploaded">
        check_circle
      </mat-icon>
    }
    @if (selectors.uploadState()?.isError) {
      <mat-icon class="icon-error" style="flex: 1 0 auto" [matTooltip]="ErrorsLocalization.errorUploadingFile">
        error
      </mat-icon>
    }
  </ui-flex-block>
}
<ui-grid-block [gridTemplateColumns]="gridCols()" gridAlignItems="center">
  <ui-grid-block [gridTemplateColumns]="gridCols()">
    <mat-slide-toggle [formControl]="form.controls.isPublic" class="slide-toggle">
      {{ SharedLocalization.isPubliclyAvailable }}
    </mat-slide-toggle>
    <mat-slide-toggle [formControl]="form.controls.isActive" class="slide-toggle">
      {{ SharedLocalization.isActive }}
    </mat-slide-toggle>
  </ui-grid-block>
  <ui-grid-block gridTemplateColumns="repeat(auto-fit, minmax(100px, 1fr))" gridAlignItems="center">
    <ng-content />
    @if (!selectors.uploadState()?.isLoading) {
      @if (!fileMetadata()) {
        <button (click)="uploadFile()" class="button-lg button-secondary" mat-flat-button>
          {{ FilesLocalization.upload }}
        </button>
      } @else {
        @if (!selectors.isLoading()) {
          <button (click)="updateMetadata()" class="button-lg button-secondary" mat-flat-button>
            <ui-flex-block gapSize="4">
              {{ SharedLocalization.save }}
              @if (hasUnsavedChanges()) {
                <indicator />
              }
            </ui-flex-block>
          </button>
        } @else {
          <ui-skeleton height="48" width="100%" />
        }
      }
    } @else {
      <ui-skeleton height="48" width="100%" />
    }
  </ui-grid-block>
</ui-grid-block>
